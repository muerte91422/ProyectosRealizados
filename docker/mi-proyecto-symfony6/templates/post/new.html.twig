{% extends 'base.html.twig' %}

{% block title %}Crear Post{% endblock %}

{% block body %}
<div class="container mt-5">
    <h1>Crear Post</h1>
    
    {{ form_start(form) }}
    
    <div class="mb-3">
        {{ form_label(form.number) }}
        {{ form_widget(form.number, {'attr': {'class': 'form-control'}}) }}
        {{ form_errors(form.number) }}
    </div>

    <div class="mb-3">
        {{ form_label(form.location) }}
        {{ form_widget(form.location, {'attr': {'class': 'form-control'}}) }}
        {{ form_errors(form.location) }}
    </div>

    <h3>Ocupaciones</h3>
    <div id="occupations" data-prototype="{{ form_widget(form.occupations.vars.prototype)|e('html_attr') }}" data-index="{{ form.occupations|length }}">
        {% for occupation in form.occupations %}
            <div class="border p-3 mb-3 bg-light occupation-item">
                {{ form_row(occupation.type) }}
                {{ form_row(occupation.wlfName) }}
                {{ form_row(occupation.seraphiteWeapons) }}
                {{ form_row(occupation.infectedTypes) }}
                {{ form_row(occupation.observation) }}
                <button type="button" class="btn btn-sm btn-danger remove-occupation mt-2">Eliminar</button>
            </div>
        {% endfor %}
    </div>

    <button type="button" class="btn btn-sm btn-primary mb-3" id="add-occupation">
        + Añadir ocupación
    </button>

    <button class="btn btn-success">Guardar</button>
    <a href="{{ path('app_post_index') }}" class="btn btn-secondary">Volver</a>
    
    {{ form_end(form) }}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const occupationsDiv = document.getElementById('occupations');
    const addButton = document.getElementById('add-occupation');
    let index = parseInt(occupationsDiv.dataset.index);

    addButton.addEventListener('click', function () {
        const prototype = occupationsDiv.dataset.prototype;
        const newForm = prototype.replace(/__name__/g, index);
        index++;

        const div = document.createElement('div');
        div.className = 'border p-3 mb-3 bg-light occupation-item';
        div.innerHTML = newForm + '<button type="button" class="btn btn-sm btn-danger remove-occupation mt-2">Eliminar</button>';
        occupationsDiv.appendChild(div);
    });

    occupationsDiv.addEventListener('click', function (e) {
        if (e.target.classList.contains('remove-occupation')) {
            e.target.closest('.occupation-item').remove();
        }
    });
});
</script>
{% endblock %}